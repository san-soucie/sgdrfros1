states:
  - controller_off
  - idle
  - error
  - sample_standard
  - debubble_standard
  - sample_adaptive
  - debubble_adaptive
  - at_top
  - turning_to_go_south
  - ready_to_go_south
  - at_bottom
  - turning_to_go_north
  - ready_to_go_north
  - beads_sequence_debubble
  - beads_sequence_beads
  - beads_sequence_biocide
  - beads_sequence_bleach
  - cartridge_debubble
transitions:
  - trigger: begin_debubble_adaptive
    source:
      - sample_adaptive
      - ready_to_go_south
      - idle
    unless:
      - manually_idled
    dest: debubble_adaptive
    conditions:
      - is_moving
      - is_going_north
      - is_ifcb_idle_or_can_acquire_better_sample
  - trigger: begin_sample_adaptive
    source: debubble_adaptive
    dest: sample_adaptive
    conditions:
      - is_ifcb_idle
      - is_moving
      - is_going_south
  - trigger: begin_debubble_standard
    source:
      - sample_standard
      - ready_to_go_north
      - idle
    conditions:
      - is_ifcb_idle
      - is_moving
      - is_going_north
    unless:
      - manually_idled
    dest: debubble_standard
  - trigger: begin_sample_standard
    source: debubble_standard
    dest: sample_standard
    conditions:
      - is_ifcb_idle
      - is_moving
      - is_going_north
  - trigger: finish_going_south
    source:
      - sample_adaptive
      - debubble_adaptive
    dest: at_bottom
    conditions:
      - is_at_bottom
  - trigger: turn_to_go_north
    source: at_bottom
    dest: turning_to_go_north
  - trigger: finish_turning_to_go_north
    source: turning_to_go_north
    dest: ready_to_go_north
    conditions:
      - is_going_north
  - trigger: finish_going_north
    source:
      - sample_standard
      - debubble_standard
    dest: at_top
    conditions:
      - is_at_top
  - trigger: turn_to_go_south
    source: at_top
    dest: turning_to_go_south
  - trigger: finish_turning_to_go_south
    source: turning_to_go_south
    dest: ready_to_go_south
    conditions:
      - is_going_south
  - trigger: to_error
    source: "*"
    dest: error
  - trigger: begin_idling
    source: "*"
    dest: idle
  - trigger: turn_off
    source: "*"
    dest: controller_off
  - trigger: turn_on
    source: controller_off
    dest: idle
  - trigger: run_beads_sequence_debubble
    source:
      - idle
      - sample_standard
      - sample_adaptive
    dest: beads_sequence_debubble
    conditions:
      - is_ifcb_idle
      - is_it_time_to_run_beads
    unless:
      - manually_idled
  - trigger: run_beads_sequence_beads
    source: beads_sequence_debubble
    dest: beads_sequence_beads
    conditions:
      - is_ifcb_idle
  - trigger: run_beads_sequence_biocide
    source: beads_sequence_beads
    dest: beads_sequence_biocide
    conditions:
      - is_ifcb_idle
  - trigger: run_beads_sequence_bleach
    source: beads_sequence_biocide
    dest: beads_sequence_bleach
    conditions:
      - is_ifcb_idle
  - trigger: finish_beads_sequence_bleach
    source: beads_sequence_bleach
    dest: idle
    conditions:
      - is_ifcb_idle
  - trigger: run_cartridge_debubble
    source:
      - idle
      - sample_standard
      - sample_adaptive
    dest: cartridge_debubble
    conditions:
      - is_ifcb_idle
      - is_it_time_to_run_cartridge_debubble
    unless:
      - manually_idled
  - trigger: finish_cartridge_debubble
    source: cartridge_debubble
    dest: idle
    conditions:
      - is_ifcb_idle
